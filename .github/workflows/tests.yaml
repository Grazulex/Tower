name: Run tests with PyTest

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
    uv-example:
        name: python
        runs-on: ubuntu-latest
        
        steps:
            - uses: actions/checkout@v4

            - name: Install uv
              uses: astral-sh/setup-uv@v5

            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                python-version-file: "pyproject.toml"

            - name: Install the project
              run: uv sync --locked --all-extras --dev

            - name: Run tests
              run: uv run pytest --junit-xml=test-results.xml

            - name: Surface failing tests
              if: always()
              uses: pmeier/pytest-results-action@main
              with:
                # A list of JUnit XML files, directories containing the former, and wildcard
                # patterns to process.
                # See @actions/glob for supported patterns.
                path: test-results.xml
            
                # (Optional) Add a summary of the results at the top of the report
                summary: true
            
                # (Optional) Select which results should be included in the report.
                # Follows the same syntax as `pytest -r`
                display-options: fEX
            
                # (Optional) Fail the workflow if no JUnit XML was found.
                fail-on-empty: true
            
                # (Optional) Title of the test results section in the workflow summary
                title: Test results